## 초난감 DAO

사용자 정보를 JDBC API를 통해 DB에 저장하고 조회할 수 있는 간단한 DAO 만들기

- DAO(Data Access Object): DB를 조회하거나 조작하는 기능을 전담하도록 만든 오브젝트

### User

사용자 정보를 저장할 때는 자바빈 규약을 따르는 오브젝트를 사용하기

```sql
create table users(
	id varchar(10) primary key,
	name varchar(20) not null,
	password varchar(10) not null
}
```

- 자바빈(JavaBean): 두 가지 관례를 따라 만들어진 오브젝트
    - 디폴트 생성자를 반드시 가져야 함: 툴이나 프레임워크에서 리플랙션을 이용해 오브젝트를 생성하기 때문
    - 프로퍼티: set으로 시작하는 수정자 메소드(setter)와 접근자 메소드(getter)를 이용해 수정하고 조회할 수 있음

### UserDao

사용자 정보를 DB에 넣고 관리할 수 있는 DAO 클래스 만들기

- JDBC를 이용해 작업하기
    - DB 연결을 위한 Connection 가져오기
    - SQL을 담은 Statement(또는 PreparedStatement) 만들기
    - 만들어진 Statement 실행하기
    - 조회의 경우 SQL 쿼리의 실행 결과를 ResultSet으로 받아서 정보를 저장할 오브젝트에 옮기기
    - 작업 중에 생성된 Connection, Statement, ResultSet 같은 리소느는 작업을 마친 후 닫아주기
    - JDBC API가 만들어내는 예의를 찾아 직접 처리하거나, 메소드에 throws를 선언해 예외가 발생하면 메소드 밖으로 던지도록 함

### main()을 이용한 DAO 테스트 코드

오브젝트 스스로 자신을 검증하도록 main 메소드를 만들어 그 안에서 UserDao의 오브젝트를 생성해 add()와 get() 메소드 검증하기

## 2. DAO의 분리

### 관심사의 분리

관심이 같은 것끼리는 하나의 객체 안으로 또는 친한 객체로 모이게 하고, 관심이 다른 것은 가능한 한 따로 떨어져서 하나의 객체 안으로 또는 친한 객체로 모이게 하고, 관심이 다른 것은 가능한 한 따로 떨어져서 서로 영향을 주지 않도록 분리 하는 것

### 커넥션 만들기의 추출

- UserDao의 관심사항
    1. DB와 연결을 위한 커넥션을 어떻게 가져올까라는 관심사
        
        어떤 DB, 어떤 드라이버, 어떤 로그인 정보를 쓰는데 그 커넥션을 생성하는 방법은 어떤 것인지까지 구분 가능
        
        DB 연결과 관련된 관심이 하나
        
    2. 사용자 등록을 위해 DB에 보낼 SQL 문장을 담을 Statement를 만들고 실행하는 것
        
        파라미터를 바인딩하는 것과 어떤 SQL을 사용할지에 대한 관심
        
    3. 작업이 끝나면 사용한 리소스인 Statement와 Connection 오브젝트를 닫아주기
- 문제점
    - DB 연결을 위한 Connection 오브젝트를 자겨오는 부분
        
        DB 커넥션을 가져오는 코드는 다른 관심사와 섞여 add 메소드에 같이 담겨 있음
        
        DB 커넥션을 가져오는 코드와 동일한 코드가 get에도 존재
        
    
    → 하나의 관심사가 중복되어 있고 흩어져있으며 다른 대상과 얽혀있어 문제가 커짐
    
- 중복 코드의 메소드 추출
    - 커넥션을 가져오는 중복된 코드를 분리
        
        중복된 코드를 독립적인 메소드로 만들어주기
        
        → DB 연결과 관련된 부분에 변경이 일어났을 경우 한 메소드의 코드만 수정하면 됨
        
- 변경 사항에 대한 검증: 리팩토링과 테스트
    
    변경된 UserDao의 기능이 변경하기 전과 동일한지 확인이 필요
    
    - 리팩토링(refactoring): 기존의 코드를 외부의 동작방식에는 변화 없이 내부 구조를 변경해서 재구성하는 작업 또는 기술
        
        내부의 설계가 개선되어 코드를 이해하기가 더 편해지고, 변화에 효율적 대응 가능
        
    - 메소드 추출(extract method): 공통의 기능을 담당하는 메소드로 중복된 코드를 뽑아내는 것

### DB 커넥션 만들기의 독립

변화를 반기는 DAO 만들기

DB 커넥션을 가져오는 방법이 변경될 가능성이 있을 경우

- 상속을 통한 확장
    
    코드를 한단계 더 분리
    
    구현 코드를 제거하고 getConnection을 추상 메소드로 만들 경우 상속해서 서브 클래스를 만들어 원하는 방식으로 구현
    
    - Factory method pattern: 구체적인 오브젝트 생성 방법을 결정하는 것